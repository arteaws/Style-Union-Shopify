{% comment %}

{% capture thumbnails %}
  {% if product.media.size > 1 %}
    {%- liquid

      if thumbnail_position == 'bottom'
        assign style = 'horizontal-carousel'
        assign width = 'span-12'
        assign js_class = 'js-thumb-horizontal-wrapper'
      else
        assign style = 'vertical-carousel'
        assign width = ''
        assign js_class = 'js-thumb-vertical-wrapper'
      endif

    -%}

    <div id="thumbnails" class="thumb-slider thumbnail-slider custom {{ style }} {{ width }} auto"
    data-thumbnail-position="{{ thumbnail_position }}">
      <div class="thumb-slider-wrapper {{ js_class }} js-thumb-wrapper" id="thumb-slider-wrapper">
        <div class="carousel-nav thumb-slider-slides slides product-single__thumbnails-{{ section.id }} js-thumb-carousel-nav{% if product.media.size <4 %} no_carousel{% endif %}">
          {% for media in product.media %}
            <div class="{{ media.media_type }}-thumbnail product-single__thumbnails-item carousel-cell {% if forloop.first %}is-nav-selected{% endif %} js-thumb-item thumb__{% if forloop.first %}first{% elsif forloop.last %}last{% endif %}" data-slide-index="{{ forloop.index0 }}"
            data-image-id="{{ media.id }}" tabindex="0">
              <div class="product-single__thumbnail product-single__thumbnail--{{ section.id }} js-thumb-item-img-wrap" data-thumbnail-id="product-template-{{ media.id }}">
                {% liquid

                  # Reset variables inside loop
                  assign loading = 'lazy'
                  assign fetch_priority = 'auto'

                  # If one a product page and the section is under index 3 (near the top) because
                  # the default template has the section below a "breadcrumb" section.
                  if template == 'product' and section.index < 3
                    if forloop.index < 10
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  elsif section.index == 1
                    if forloop.index < 10
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  endif
                 %}
                {%
                  render 'basic-responsive-image',
                  type: media.preview_image,
                  width: 1200,
                  img_class: 'js-thumb-item-img',
                  loading: loading,
                  fetchpriority: fetch_priority
                %}
                {%- if media.media_type == 'video' or media.media_type =='external_video' -%}
                  <div class="thumbnail-icon">
                    {% render 'snip-icons',
                       wrapper: '.thumbnail-icon',
                       type: 'media-icons',
                       icon: 'play',
                       classes: 'thumbnail-icon-video--icon vib-center',
                       size: '25px',
                       fill: 'var(--text-color)',
                       hover: 'var(--text-color)' %}
                  </div>
                {%- endif -%}
                {%- if media.media_type == 'model' -%}
                  <div class="thumbnail-icon">
                    {% render 'snip-icons',
                       wrapper: '.thumbnail-icon',
                       type: 'media-icons',
                       icon: '3d-icon',
                       classes: 'thumbnail-icon-model--icon vib-center',
                       size: '25px',
                       fill: 'var(--text-color)',
                       hover: 'var(--text-color)' %}
                  </div>
                {%- endif -%}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
{% endcapture %}

{% capture slider %}
  {%- liquid

    assign grid_width = ""

    if product.media.size > 1 and thumbnail_position != 'bottom'
      assign grid_width = "reduced-size"
    else
      assign grid_width = "span-12"
    endif

    if product.media.size <= 1
      assign no_slider = 'single-media'
    endif

    assign first_image = product.media | where: "media_type", "image" | first

  -%}
  <div id="slider" class=" {{ grid_width }} thumbs_{{ thumbnail_position }} auto {{ no_slider }}">
    <!-- <div id="smartwishlist" data-product="{{ product.id }}" data-variant="{{ product.variants.first.id }}"></div> -->
    <div class="slides product-image-container carousel carousel-main js-carousel-main" data-product-id="{{ product.id }}">
      {% for media in product.media %}
        <div class="{{ media.media_type }}-slide carousel-cell js-main-carousel-cell" data-image-id="{{ media.id }}" data-slide-index="{{ forloop.index0 }}" tabindex="-1">
          <div class="product-media-container product-media--{{ media.id }} {{ media.media_type }}"
          data-product-single-media-wrapper
          {% if media.media_type == 'video' %} data-product-media-type-video data-enable-video-looping="{{ enable_video_looping }}"{% endif %}
          {% if media.media_type == 'external_video' %} data-product-media-type-video data-enable-video-looping="{{ enable_video_looping }}" data-video-id="{{ media.external_id }}"{% endif %}
          {% if media.media_type == 'model' %} data-product-media-type-model{% endif %}
          data-thumbnail-id="product-template-{{ media.id }}"
          data-media-id="product-template-{{ media.id }}">
            {% case media.media_type %}
              {% when 'image' %}
                {%- liquid

                  assign image_box_ratio = media.height | append: ".0" | times: 1 | divided_by: media.width | times: 100 | append: "%"
                  assign zoom_image = media | image_url: width: 2400

                  assign loading = 'lazy'
                  assign fetch_priority = 'auto'

                  if template == 'product' and section.index < 3
                    if first_image.id == media.id
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  elsif section.index == 1
                    if first_image.id == media.id
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  endif

                -%}

                {% capture sizes %}
                  (min-width: 1601px) {{ lg_render | default: '2000px' }},
                  (min-width: 768px) and (max-width: 1600px) {{ md_render | default: '1200px' }},
                  (max-width: 767px) {{ sm_render | default: '100vw' }}, 900px
                {% endcapture %}

                <div class="box-ratio" style="padding-bottom: {{ image_box_ratio }};">
                  {{ media | image_url: width: 1200 | image_tag:
                    loading: loading,
                    fetchpriority: fetch_priority,
                    sizes: sizes,
                    widths: '200, 300, 400, 500, 600, 700, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000',
                    id: media.id,
                    data-zoom-src: zoom_image,
                    class: 'product__image',
                    data-aspect-ratio: media.aspect_ratio,
                    data-width: media.width,
                    data-height: media.height
                  }}
                </div>
                <noscript>{{ media | image_url: width: 1200 | image_tag }}</noscript>
                {% if click_to_enlarge and template != 'product.quick' %}
                  <a class="zoom_btn"
                     href="{{ media | image_url: width: 2400 }}"
                     itemprop="contentUrl"
                     tabindex="-1"
                     title="Click to zoom"
                     data-index="{{ forloop.index0 }}"
                     data-ps-slide-index="{% increment my_counter %}"
                     data-count="{{ forloop.length }}">
                     {% render 'snip-icons',
                        wrapper: '.zoom_btn',
                        type: 'apollo',
                        icon: 'search',
                        classes: 'zoom_btn--icon vib-center',
                        size: '16px',
                        fill: 'var(--directional-color)',
                        hover: 'var(--directional-hover-color)' %}
                  </a>
                {% endif %}
              {% when 'external_video' %}
                <div class="product-video videoWrapper product-single__media">
                  <deferred-media class="deferred-media">
                    <template>
                      {% liquid

                        assign video_class = 'js-' | append: media.host

                        echo media | external_video_url: autoplay: true, loop: enable_video_looping | external_video_tag: class: video_class, loading: "lazy"
                       %}
                    </template>
                  </deferred-media>
                </div>
              {% when 'video' %}
                {% style %}
                  @media screen and (max-width: 320px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 360 }}) !important;
                    }
                  }
                  @media screen and (min-width: 320px) and (max-width: 780px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 900 }}) !important;
                    }
                  }
                  @media screen and (min-width: 780px) and (max-width: 1080px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 1080 }}) !important;
                    }
                  }
                  @media screen and (min-width: 1080px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 2048 }}) !important;
                    }
                  }
                {% endstyle %}
                <div class="product-video product-single__media js-video-plyr-wrapper">
                  {{ media | video_tag: controls: true, class: 'media-video', image_size: '800x' }}
                </div>
              {% when 'model' %}
                <div class="product-model product-single__media" style="padding-bottom: 100%">
                  {{ media | model_viewer_tag: image_size: '800x', reveal: 'interaction', toggleable: true, data-model-id: media.id }}
                </div>
            {% endcase %}
          </div>
          <noscript>
            <img id="{{ media.id }}" class="product-main-image" src="{{ featured_media | img_url: '800x' }}" alt='{{ media.alt | escape }}'/>
          </noscript>
        </div>
      {% endfor %}
    </div>
    {% assign first_3d_model = product.media | where: "media_type", "model" | first %}
    {%- if first_3d_model -%}
      <button
        aria-label="{{ 'products.product.view_in_space_label' | t }}"
        class="media-button product-single__view-in-space"
        data-shopify-xr
        data-shopify-model3d-id="{{ first_3d_model.id }}"
        data-shopify-title="{{ product.title | escape }}"
        data-shopify-xr-hidden>
        {% render 'snip-icons',
         wrapper: '.product-single__view-in-space',
         type: 'media-icons',
         icon: '3d-icon',
         classes: 'product-single__view-in-space--icon vib-center',
         size: '25px',
         fill: 'var(--text-color)',
         hover: 'var(--text-color)' %}
         <span class='product-single__view-in-space-text vib-center'>{{ 'products.product.view_in_space' | t }}</span>
      </button>
    {%- endif -%}
  </div>
{% endcapture %}

{%- if thumbnail_position == 'left' -%}
<div class="product__gallery--container">
  {{ thumbnails }}
  {{ slider }}
</div>
{%- elsif thumbnail_position == 'right' -%}
<div class="product__gallery--container">
  {{ slider }}
  {{ thumbnails }}
</div>
{%- elsif thumbnail_position == 'bottom' -%}
  {{ slider }}
  {{ thumbnails }}
{%- endif -%}
{% endcomment %}

<style>
.product__section-details div#smartwishlist {
    display: none;
}

/* Fade effect styles */
.thumbnail-fade-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 10;
}

.thumbnail-fade-overlay.active {
    opacity: 1;
}

.thumb-slider-slides {
    transition: transform 0.5s ease;
}

.product-single__thumbnails-item {
    position: relative;
    transition: all 0.3s ease;
}

/* Black border only for manually clicked thumbnails */
.product-single__thumbnails-item.manually-selected {
    border: 2px solid #000 !important;
}

/* Remove default active styling for variant changes */
.product-single__thumbnails-item.is-nav-selected {
    border: none !important;
}

@media (max-width: 768px) {
  .product__gallery--container {
    display: flex;
    flex-direction: column-reverse;
  }
  
  /* Thumbnails container */
  #thumbnails.thumbnail-slider {
        position: relative !important;
        width: 100% !important;
        margin-top: 10px;
        height: auto !important;
        max-width: 500px !important;
        margin: 1rem 0 !important;
    }
  
  /* Thumbnail wrapper */
  .thumb-slider-wrapper {
    height: auto !important;
    overflow: visible !important;
  }
  
  /* Thumbnail slides container */
  .thumb-slider-slides {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: nowrap !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    height: auto !important;
    transform: none !important;
    padding: 5px 0;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
  }
  
  /* Individual thumbnail items */
  .thumb-slider-slides .product-single__thumbnails-item {
    flex: 0 0 auto !important;
    width: 80px !important;
    height: 80px !important;
    margin-right: 10px !important;
    margin-bottom: 0 !important;
    display: block !important;
    scroll-snap-align: start;
  }
  
  /* Main slider adjustments */
  #slider.reduced-size {
    width: 100% !important;
    margin-bottom: 0 !important;
  }
  
  /* Ensure thumbnails are visible */
  .product-single__thumbnail {
    opacity: 1 !important;
    visibility: visible !important;
  }
  
  /* Remove any potential hiding of thumbnails */
  .js-thumb-item {
    display: block !important;
  }
  
  .product__section-images.product__section-image--left.carousel-container.js-product-gallery.span-6.md-span-12.sm-span-12.auto.desktop-gallerr-cs.aos-init.aos-animate {
    margin-left: 0 !important;
    margin-right: 0 !important;
    float: 0 !important;
  }
}

/* Desktop styles */
@media (min-width: 769px) {
  /* For left/right thumbnails - move active to top with fade */
  .thumb-slider.vertical-carousel .product-single__thumbnails-item.is-nav-selected {
    order: -1 !important;
    margin-bottom: 10px !important;
  }
}
</style>

{% capture thumbnails %}
  {% if product.media.size > 1 %}
    {%- liquid

      if thumbnail_position == 'bottom'
        assign style = 'horizontal-carousel'
        assign width = 'span-12'
        assign js_class = 'js-thumb-horizontal-wrapper'
      else
        assign style = 'vertical-carousel'
        assign width = ''
        assign js_class = 'js-thumb-vertical-wrapper'
      endif

    -%}

    <div id="thumbnails" class="thumb-slider thumbnail-slider custom {{ style }} {{ width }} auto"
    data-thumbnail-position="{{ thumbnail_position }}">
      <div class="thumb-slider-wrapper {{ js_class }} js-thumb-wrapper" id="thumb-slider-wrapper">
        <div class="carousel-nav thumb-slider-slides slides product-single__thumbnails-{{ section.id }} js-thumb-carousel-nav{% if product.media.size <4 %} no_carousel{% endif %}">
          {% for media in product.media %}
            <div class="{{ media.media_type }}-thumbnail product-single__thumbnails-item carousel-cell {% if forloop.first %}is-nav-selected{% endif %} js-thumb-item thumb__{% if forloop.first %}first{% elsif forloop.last %}last{% endif %}" data-slide-index="{{ forloop.index0 }}"
            data-image-id="{{ media.id }}" tabindex="0">
              <div class="thumbnail-fade-overlay"></div>
              <div class="product-single__thumbnail product-single__thumbnail--{{ section.id }} js-thumb-item-img-wrap" data-thumbnail-id="product-template-{{ media.id }}">
                {% liquid

                  # Reset variables inside loop
                  assign loading = 'lazy'
                  assign fetch_priority = 'auto'

                  # If one a product page and the section is under index 3 (near the top) because
                  # the default template has the section below a "breadcrumb" section.
                  if template == 'product' and section.index < 3
                    if forloop.index < 10
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  elsif section.index == 1
                    if forloop.index < 10
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  endif
                 %}
                {%
                  render 'basic-responsive-image',
                  type: media.preview_image,
                  width: 1200,
                  img_class: 'js-thumb-item-img',
                  loading: loading,
                  fetchpriority: fetch_priority
                %}
                {%- if media.media_type == 'video' or media.media_type =='external_video' -%}
                  <div class="thumbnail-icon">
                    {% render 'snip-icons',
                       wrapper: '.thumbnail-icon',
                       type: 'media-icons',
                       icon: 'play',
                       classes: 'thumbnail-icon-video--icon vib-center',
                       size: '25px',
                       fill: 'var(--text-color)',
                       hover: 'var(--text-color)' %}
                  </div>
                {%- endif -%}
                {%- if media.media_type == 'model' -%}
                  <div class="thumbnail-icon">
                    {% render 'snip-icons',
                       wrapper: '.thumbnail-icon',
                       type: 'media-icons',
                       icon: '3d-icon',
                       classes: 'thumbnail-icon-model--icon vib-center',
                       size: '25px',
                       fill: 'var(--text-color)',
                       hover: 'var(--text-color)' %}
                  </div>
                {%- endif -%}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
{% endcapture %}

{% capture slider %}
  {%- liquid

    assign grid_width = ""

    if product.media.size > 1 and thumbnail_position != 'bottom'
      assign grid_width = "reduced-size"
    else
      assign grid_width = "span-12"
    endif

    if product.media.size <= 1
      assign no_slider = 'single-media'
    endif

    assign first_image = product.media | where: "media_type", "image" | first

  -%}
  <div id="slider" class=" {{ grid_width }} thumbs_{{ thumbnail_position }} auto {{ no_slider }}">
<div class="custom-badges">
  {% if product.metafields.custom.custom_badges %}
    {% assign badge_value = product.metafields.custom.custom_badges | downcase | strip | replace: " ", "" %}
    
    {% case badge_value %}
      {% when 'bestsellers' %}
        <span class="product-badge">Most loved</span>
      {% when 'newin2' %}
        <span class="product-badge">New In</span>
      {% when 'lastfew' %}
        <span class="product-badge">Few Left</span>
      {% when 'musthave' %}
        <span class="product-badge">Must Have</span>
      {% when 'sellingfast' %}
        <span class="product-badge">Selling Fast</span>
    {% endcase %}
  {% endif %}
</div>
    <div class="slides product-image-container carousel carousel-main js-carousel-main" data-product-id="{{ product.id }}">
      {% for media in product.media %}
        <div class="{{ media.media_type }}-slide carousel-cell js-main-carousel-cell" data-image-id="{{ media.id }}" data-slide-index="{{ forloop.index0 }}" tabindex="-1">
          <div class="product-media-container product-media--{{ media.id }} {{ media.media_type }}"
          data-product-single-media-wrapper
          {% if media.media_type == 'video' %} data-product-media-type-video data-enable-video-looping="{{ enable_video_looping }}"{% endif %}
          {% if media.media_type == 'external_video' %} data-product-media-type-video data-enable-video-looping="{{ enable_video_looping }}" data-video-id="{{ media.external_id }}"{% endif %}
          {% if media.media_type == 'model' %} data-product-media-type-model{% endif %}
          data-thumbnail-id="product-template-{{ media.id }}"
          data-media-id="product-template-{{ media.id }}">
            {% case media.media_type %}
              {% when 'image' %}
                {%- liquid

                  assign image_box_ratio = media.height | append: ".0" | times: 1 | divided_by: media.width | times: 100 | append: "%"
                  assign zoom_image = media | image_url: width: 2400

                  assign loading = 'lazy'
                  assign fetch_priority = 'auto'

                  if template == 'product' and section.index < 3
                    if first_image.id == media.id
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  elsif section.index == 1
                    if first_image.id == media.id
                      assign loading = 'eager'
                      assign fetch_priority = 'high'
                    endif
                  endif

                -%}

                {% capture sizes %}
                  (min-width: 1601px) {{ lg_render | default: '2000px' }},
                  (min-width: 768px) and (max-width: 1600px) {{ md_render | default: '1200px' }},
                  (max-width: 767px) {{ sm_render | default: '100vw' }}, 900px
                {% endcapture %}

                <div class="box-ratio" style="padding-bottom: {{ image_box_ratio }};">
                  {{ media | image_url: width: 1200 | image_tag:
                    loading: loading,
                    fetchpriority: fetch_priority,
                    sizes: sizes,
                    widths: '200, 300, 400, 500, 600, 700, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000',
                    id: media.id,
                    data-zoom-src: zoom_image,
                    class: 'product__image',
                    data-aspect-ratio: media.aspect_ratio,
                    data-width: media.width,
                    data-height: media.height
                  }}
                </div>
                <noscript>{{ media | image_url: width: 1200 | image_tag }}</noscript>
                {% if click_to_enlarge and template != 'product.quick' %}
                  <a class="zoom_btn"
                     href="{{ media | image_url: width: 2400 }}"
                     itemprop="contentUrl"
                     tabindex="-1"
                     title="Click to zoom"
                     data-index="{{ forloop.index0 }}"
                     data-ps-slide-index="{% increment my_counter %}"
                     data-count="{{ forloop.length }}">
                     {% render 'snip-icons',
                        wrapper: '.zoom_btn',
                        type: 'apollo',
                        icon: 'search',
                        classes: 'zoom_btn--icon vib-center',
                        size: '16px',
                        fill: 'var(--directional-color)',
                        hover: 'var(--directional-hover-color)' %}
                  </a>
                {% endif %}
              {% when 'external_video' %}
                <div class="product-video videoWrapper product-single__media">
                  <deferred-media class="deferred-media">
                    <template>
                      {% liquid

                        assign video_class = 'js-' | append: media.host

                        echo media | external_video_url: autoplay: true, loop: enable_video_looping | external_video_tag: class: video_class, loading: "lazy"
                       %}
                    </template>
                  </deferred-media>
                </div>
              {% when 'video' %}
                {% style %}
                  @media screen and (max-width: 320px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 360 }}) !important;
                    }
                  }
                  @media screen and (min-width: 320px) and (max-width: 780px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 900 }}) !important;
                    }
                  }
                  @media screen and (min-width: 780px) and (max-width: 1080px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 1080 }}) !important;
                    }
                  }
                  @media screen and (min-width: 1080px) {
                    .product-media--{{ media.id }} .plyr__poster {
                      background-image: url({{ media.preview_image | image_url: width: 2048 }}) !important;
                    }
                  }
                {% endstyle %}
                <div class="product-video product-single__media js-video-plyr-wrapper">
                  {{ media | video_tag: controls: true, class: 'media-video', image_size: '800x' }}
                </div>
              {% when 'model' %}
                <div class="product-model product-single__media" style="padding-bottom: 100%">
                  {{ media | model_viewer_tag: image_size: '800x', reveal: 'interaction', toggleable: true, data-model-id: media.id }}
                </div>
            {% endcase %}
          </div>
          <noscript>
            <img id="{{ media.id }}" class="product-main-image" src="{{ featured_media | img_url: '800x' }}" alt='{{ media.alt | escape }}'/>
          </noscript>
        </div>
      {% endfor %}
    </div>
    {% assign first_3d_model = product.media | where: "media_type", "model" | first %}
    {%- if first_3d_model -%}
      <button
        aria-label="{{ 'products.product.view_in_space_label' | t }}"
        class="media-button product-single__view-in-space"
        data-shopify-xr
        data-shopify-model3d-id="{{ first_3d_model.id }}"
        data-shopify-title="{{ product.title | escape }}"
        data-shopify-xr-hidden>
        {% render 'snip-icons',
         wrapper: '.product-single__view-in-space',
         type: 'media-icons',
         icon: '3d-icon',
         classes: 'product-single__view-in-space--icon vib-center',
         size: '25px',
         fill: 'var(--text-color)',
         hover: 'var(--text-color)' %}
         <span class='product-single__view-in-space-text vib-center'>{{ 'products.product.view_in_space' | t }}</span>
      </button>
    {%- endif -%}
  </div>
{% endcapture %}

{%- if thumbnail_position == 'left' -%}
<div class="product__gallery--container">
  {{ thumbnails }}
  {{ slider }}
</div>
{%- elsif thumbnail_position == 'right' -%}
<div class="product__gallery--container">
  {{ slider }}
  {{ thumbnails }}
</div>
{%- elsif thumbnail_position == 'bottom' -%}
  {{ slider }}
  {{ thumbnails }}
{%- endif -%}

<script>
document.addEventListener('DOMContentLoaded', function() {
  let isVariantChange = false;
  
  // Function to check if we're on mobile
  function isMobile() {
    return window.innerWidth <= 768;
  }
  
  // Function to add fade overlay to thumbnails
  function addFadeEffect() {
    const thumbnails = document.querySelectorAll('.product-single__thumbnails-item');
    thumbnails.forEach(thumb => {
      const overlay = thumb.querySelector('.thumbnail-fade-overlay');
      if (overlay) {
        overlay.classList.add('active');
      }
    });
  }

  // Function to remove fade overlay
  function removeFadeEffect() {
    const thumbnails = document.querySelectorAll('.product-single__thumbnails-item');
    thumbnails.forEach(thumb => {
      const overlay = thumb.querySelector('.thumbnail-fade-overlay');
      if (overlay) {
        overlay.classList.remove('active');
      }
    });
  }

  // Function to reorder thumbnails with fade effect (only for variant changes)
  function reorderThumbnailsWithFade(activeIndex) {
    const thumbnailContainer = document.querySelector('.thumb-slider-slides');
    if (!thumbnailContainer) return;
    
    const thumbnails = Array.from(thumbnailContainer.children);
    if (thumbnails.length <= 1) return;
    
    // Add fade effect
    addFadeEffect();
    
    // Wait for fade effect, then reorder
    setTimeout(() => {
      // Create new order: active thumbnail first, then the ones after it, then the ones before
      const reorderedThumbnails = [
        thumbnails[activeIndex],
        ...thumbnails.slice(activeIndex + 1),
        ...thumbnails.slice(0, activeIndex)
      ];
      
      // Remove all thumbnails
      while (thumbnailContainer.firstChild) {
        thumbnailContainer.removeChild(thumbnailContainer.firstChild);
      }
      
      // Add them back in new order
      reorderedThumbnails.forEach(thumb => {
        thumbnailContainer.appendChild(thumb);
      });
      
      // Scroll to start position (show active thumbnail first) - ONLY for variant changes
      if (isMobile() && isVariantChange) {
        thumbnailContainer.scrollLeft = 0;
      }
      
      // Remove fade effect after reordering
      setTimeout(() => {
        removeFadeEffect();
      }, 150);
      
    }, 300); // Wait for fade effect duration
  }

  // Function to handle variant changes
  function handleVariantChange() {
    isVariantChange = true;
    
    const activeThumb = document.querySelector('.product-single__thumbnails-item.is-nav-selected');
    if (!activeThumb) return;
    
    // Remove all selection classes
    document.querySelectorAll('.product-single__thumbnails-item').forEach(thumb => {
      thumb.classList.remove('is-nav-selected', 'manually-selected');
    });
    
    // Add selected class to active thumb (no border for variant changes)
    activeThumb.classList.add('is-nav-selected');
    
    // Get the index of the active thumbnail in the current order
    const thumbnails = Array.from(document.querySelectorAll('.product-single__thumbnails-item'));
    const activeIndex = thumbnails.findIndex(thumb => thumb === activeThumb);
    
    // Reorder thumbnails with fade effect (this will also reset scroll position)
    reorderThumbnailsWithFade(activeIndex);
    
    setTimeout(() => {
      isVariantChange = false;
    }, 1000);
  }
  
  // Listen for variant changes
  const variantSelects = document.querySelectorAll('input[name="id"], select[name="id"]');
  variantSelects.forEach(select => {
    select.addEventListener('change', function() {
      // Wait a moment for the gallery to update
      setTimeout(handleVariantChange, 100);
    });
  });
  
  // Handle thumbnail clicks - Different behavior for mobile vs desktop
  document.addEventListener('click', function(e) {
    const clickedThumb = e.target.closest('.product-single__thumbnails-item');
    if (!clickedThumb || isVariantChange) return;
    
    // Store current scroll position for mobile
    const thumbnailContainer = document.querySelector('.thumb-slider-slides');
    const currentScroll = isMobile() ? thumbnailContainer.scrollLeft : 0;
    
    // Remove all selection classes
    document.querySelectorAll('.product-single__thumbnails-item').forEach(thumb => {
      thumb.classList.remove('is-nav-selected', 'manually-selected');
    });
    
    // Add manual selection class (this will show the black border)
    clickedThumb.classList.add('manually-selected');
    
    // MOBILE: Prevent scrolling and restore position
    if (isMobile()) {
      // Prevent any default thumbnail click behavior that might cause scrolling
      e.preventDefault();
      
      // Restore scroll position after a small delay to ensure any default behavior is overridden
      setTimeout(() => {
        thumbnailContainer.scrollLeft = currentScroll;
      }, 50);
      
      return;
    }
  });
  
  // Handle initial load - only reorder if needed
  const initialActiveThumb = document.querySelector('.product-single__thumbnails-item.is-nav-selected');
  if (initialActiveThumb) {
    const thumbnails = Array.from(document.querySelectorAll('.product-single__thumbnails-item'));
    const activeIndex = thumbnails.findIndex(thumb => thumb === initialActiveThumb);
    // Only reorder on initial load if it's not the first thumbnail
    if (activeIndex > 0) {
      reorderThumbnailsWithFade(activeIndex);
    }
  }
});
</script>