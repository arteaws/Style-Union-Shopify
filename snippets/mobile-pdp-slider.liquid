<style>
/* Mobile PDP Media Gallery Styles - FIXED */
.mobile-pdp-slider {
    margin: 0 !important;
    float: unset !important;
}
  
.mobile_pdp_media_gallery {
  position: relative;
  width: 100%;
  max-width: 100%;
  overflow: hidden; /* Prevent any overflow */
}

/* Main Swiper Container - FIXED */
.mobile_pdp_media_gallery .pdpMobileSwiper {
  width: 100%;
  height: 100vw; /* Square aspect ratio for mobile */
  max-height: 400px; /* Prevent too large on bigger screens */
  position: relative;
  overflow: hidden;
  border-radius: 8px;
  margin-bottom: 16px;
  background: #f8f9fa;
}

.mobile_pdp_media_gallery .swiper-wrapper {
  height: 100%;
  width: 100%;
}

.mobile_pdp_media_gallery .swiper-slide {
  width: 100% !important;
  height: 100% !important;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden; /* Prevent content overflow */
  position: relative;
}

/* FIXED - Main slider images */
.mobile_pdp_media_gallery .mobile_pdp_swiper_images {
  width: 100%;
  height: 100%;
  object-fit: contain; /* Ensure full image is visible */
  object-position: center;
  display: block;
  background: white;
  max-width: 100%;
  max-height: 100%;
}

/* Video styling - FIXED */
.mobile_pdp_media_gallery .pdpMobileSwiper video {
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: black;
  border-radius: 4px;
  max-width: 100%;
  max-height: 100%;
}

/* Main Swiper Navigation Buttons */
.mobile_pdp_media_gallery .swiper-button-prev,
.mobile_pdp_media_gallery .swiper-button-next {
  width: 36px;
  height: 36px;
  margin-top: -18px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(8px);
  transition: all 0.3s ease;
  opacity: 0.9;
  z-index: 10;
}

.mobile_pdp_media_gallery .swiper-button-prev::after,
.mobile_pdp_media_gallery .swiper-button-next::after {
  font-size: 14px;
  font-weight: bold;
  color: #333;
}

.mobile_pdp_media_gallery .swiper-button-prev:hover,
.mobile_pdp_media_gallery .swiper-button-next:hover {
  background: rgba(255, 255, 255, 1);
  transform: scale(1.05);
  opacity: 1;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.mobile_pdp_media_gallery .swiper-button-prev {
  left: 12px;
}

.mobile_pdp_media_gallery .swiper-button-next {
  right: 12px;
}

/* Thumbnails Container */
.mobile_pdp_media_gallery .mobile_pdp_thumbnails_container {
  width: 100%;
  padding: 0 12px;
  margin-top: 8px;
  overflow: hidden;
}

.mobile_pdp_media_gallery .pdpThumbnailSwiper {
  width: 100%;
  overflow: visible;
  padding: 8px 0;
}

.mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide {
  /* width: 60px !important; */
  /* height: 60px; */
  margin-right: 8px;
  cursor: pointer;
  border-radius: 6px;
  overflow: hidden;
  border: 2px solid transparent;
  transition: all 0.3s ease;
  position: relative;
  background: #f8f9fa;
  flex-shrink: 0;
}

.mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  border-color: rgba(28, 66, 163, 0.3);
}

.mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide.active {
  border-color: #1C42A3;
  box-shadow: 0 4px 16px rgba(28, 66, 163, 0.25);
  transform: translateY(-2px);
}

.mobile_pdp_media_gallery .mobile_pdp_thumbnail_image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: all 0.3s ease;
}

.mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide:hover .mobile_pdp_thumbnail_image {
  transform: scale(1.05);
}

.mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide.active .mobile_pdp_thumbnail_image {
  opacity: 1;
}

/* Video Thumbnail Styles */
.mobile_pdp_media_gallery .mobile_pdp_video_thumbnail {
  position: relative;
  width: 100%;
  height: 100%;
}

.mobile_pdp_media_gallery .mobile_pdp_video_play_icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 20px;
  height: 20px;
  background: rgba(0, 0, 0, 0.7);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(4px);
  transition: all 0.3s ease;
}

.mobile_pdp_media_gallery .mobile_pdp_video_play_icon svg {
  width: 10px;
  height: 10px;
}

.mobile_pdp_media_gallery .mobile_pdp_video_thumbnail:hover .mobile_pdp_video_play_icon {
  background: rgba(28, 66, 163, 0.9);
  transform: translate(-50%, -50%) scale(1.1);
}

.mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide.active .mobile_pdp_video_play_icon {
  background: rgba(28, 66, 163, 0.8);
}

/* Responsive Design - IMPROVED */
@media (min-width: 375px) {
  .mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide {
    /* width: 65px !important; */
    /* height: 65px; */
    margin-right: 10px;
  }
}

@media (min-width: 414px) {
  .mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide {
    /* width: 70px !important; */
    /* height: 70px; */
    margin-right: 12px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-prev,
  .mobile_pdp_media_gallery .swiper-button-next {
    width: 40px;
    height: 40px;
    margin-top: -20px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-prev::after,
  .mobile_pdp_media_gallery .swiper-button-next::after {
    font-size: 16px;
  }
}

@media (min-width: 480px) {
  .mobile_pdp_media_gallery .pdpMobileSwiper {
    height: 400px; /* Fixed height for larger screens */
    max-height: 400px;
  }
  
  .mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide {
    /* width: 75px !important; */
    /* height: 75px; */
    margin-right: 14px;
  }
  
  .mobile_pdp_media_gallery .mobile_pdp_thumbnails_container {
    padding: 0 16px;
  }
  
  .mobile_pdp_media_gallery .mobile_pdp_video_play_icon {
    width: 24px;
    height: 24px;
  }
  
  .mobile_pdp_media_gallery .mobile_pdp_video_play_icon svg {
    width: 12px;
    height: 12px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-prev,
  .mobile_pdp_media_gallery .swiper-button-next {
    width: 44px;
    height: 44px;
    margin-top: -22px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-prev {
    left: 16px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-next {
    right: 16px;
  }
}

/* Extra small screens */
@media (max-width: 320px) {
  .mobile_pdp_media_gallery .mobile_pdp_thumbnail_slide {
    /* width: 55px !important; */
    /* height: 55px; */
    margin-right: 6px;
  }
  
  .mobile_pdp_media_gallery .mobile_pdp_thumbnails_container {
    padding: 0 8px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-prev,
  .mobile_pdp_media_gallery .swiper-button-next {
    width: 32px;
    height: 32px;
    margin-top: -16px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-prev::after,
  .mobile_pdp_media_gallery .swiper-button-next::after {
    font-size: 12px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-prev {
    left: 8px;
  }
  
  .mobile_pdp_media_gallery .swiper-button-next {
    right: 8px;
  }
  
  .mobile_pdp_media_gallery .mobile_pdp_video_play_icon {
    width: 18px;
    height: 18px;
  }
  
  .mobile_pdp_media_gallery .mobile_pdp_video_play_icon svg {
    width: 9px;
    height: 9px;
  }
}

/* Ensure no horizontal overflow */
.mobile_pdp_media_gallery * {
  box-sizing: border-box;
}
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<div class="mobile_pdp_media_gallery">
  <!-- Main Product Images Slider -->
  <div class="swiper pdpMobileSwiper">
    <div class="swiper-wrapper">
      {% for media in product.media %}
        {% case media.media_type %}
          {% when 'image' %}
            <div class="swiper-slide">
              <img
                class="mobile_pdp_swiper_images"
                srcset="
                  {% if media.width >= 375 %}{{ media | image_url: width: 375 }} 375w,{% endif %}
                  {% if media.width >= 550 %}{{ media | image_url: width: 550 }} 550w,{% endif %}
                  {% if media.width >= 750 %}{{ media | image_url: width: 750 }} 750w,{% endif %}
                  {% if media.width >= 1100 %}{{ media | image_url: width: 1100 }} 1100w,{% endif %}
                  {% if media.width >= 1500 %}{{ media | image_url: width: 1500 }} 1500w,{% endif %}
                  {{ media | image_url }} {{ media.width }}w
                "
                sizes="(max-width: 750px) 100vw, 50vw"
                src="{{ media | image_url: width: 750 }}"
                loading="lazy"
                data-index="{{ forloop.index0 }}"
                alt="{{ media.alt | escape }}"
                width="{{ media.width }}"
                height="{{ media.height }}"
              >
            </div>
          
          {% when 'video' %}
            <div class="swiper-slide">
              {{
                media | video_tag:
                  image_size: '1100x',
                  loop: section.settings.enable_video_looping,
                  controls: true,
                  muted: false
              }}
            </div>
            
          {% when 'external_video' %}
            <div class="swiper-slide">
              {{ media | external_video_tag }}
            </div>
            
          {% when 'model' %}
            <div class="swiper-slide">
              {{ media | model_viewer_tag }}
            </div>
            
          {% else %}
            <div class="swiper-slide">
              {{ media | media_tag }}
            </div>
        {% endcase %}
      {% endfor %}
    </div>

    <!-- Navigation Arrows -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>

  <!-- Thumbnails Slider -->
  <div class="mobile_pdp_thumbnails_container">
    <div class="swiper pdpThumbnailSwiper">
      <div class="swiper-wrapper">
        {% for media in product.media %}
          {% if media.media_type == 'image' %}
            <div class="swiper-slide mobile_pdp_thumbnail_slide">
              <img
                class="mobile_pdp_thumbnail_image"
                src="{{ media | image_url: width: 150 }}"
                alt="{{ media.alt | escape }}"
                data-index="{{ forloop.index0 }}"
                loading="lazy"
              >
            </div>
          {% else %}
            <div class="swiper-slide mobile_pdp_thumbnail_slide">
              <div class="mobile_pdp_video_thumbnail">
                <img
                  class="mobile_pdp_thumbnail_image"
                  src="{{ media.preview_image | image_url: width: 150 }}"
                  alt="{{ media.alt | escape }}"
                  data-index="{{ forloop.index0 }}"
                  loading="lazy"
                >
                <div class="mobile_pdp_video_play_icon">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 5v14l11-7z" fill="white"/>
                  </svg>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  try {
    let pdpMobileProductSwiper = null;
    let pdpThumbnailSwiper = null;

    // Initialize main product swiper first
    pdpMobileProductSwiper = new Swiper('.pdpMobileSwiper', {
      slidesPerView: 1,
      spaceBetween: 0,
      loop: false,
      autoHeight: false,
      centeredSlides: true,
      navigation: {
        prevEl: '.pdpMobileSwiper .swiper-button-prev',
        nextEl: '.pdpMobileSwiper .swiper-button-next',
      },
      on: {
        slideChange: function() {
          updateThumbnailActive(this.activeIndex);
        }
      }
    });

    // Initialize thumbnail swiper
    pdpThumbnailSwiper = new Swiper('.pdpThumbnailSwiper', {
      slidesPerView: 'auto',
      spaceBetween: 0,
      freeMode: true,
      watchSlidesProgress: true,
      centeredSlides: false,
      breakpoints: {
        320: {
          slidesPerView: 4.5,
        },
        375: {
          slidesPerView: 5,
        },
        414: {
          slidesPerView: 5.5,
        },
        480: {
          slidesPerView: 6,
        }
      }
    });

    // Function to update active thumbnail
    function updateThumbnailActive(activeIndex) {
      const thumbnails = document.querySelectorAll('.mobile_pdp_thumbnail_slide');
      
      thumbnails.forEach((thumb, index) => {
        thumb.classList.remove('active');
        if (index === activeIndex) {
          thumb.classList.add('active');
          
          // Center the active thumbnail in view
          if (pdpThumbnailSwiper) {
            const slideToIndex = Math.max(0, index - 2); // Show 2 slides before active
            pdpThumbnailSwiper.slideTo(slideToIndex, 300);
          }
        }
      });
    }

    // Add click handlers to thumbnails
    const thumbnails = document.querySelectorAll('.mobile_pdp_thumbnail_slide');
    thumbnails.forEach((thumbnail, index) => {
      thumbnail.addEventListener('click', (e) => {
        e.preventDefault();
        
        if (pdpMobileProductSwiper) {
          pdpMobileProductSwiper.slideTo(index, 300);
        }
        updateThumbnailActive(index);
      });

      // Add hover effect for better UX
      thumbnail.addEventListener('mouseenter', () => {
        if (!thumbnail.classList.contains('active')) {
          thumbnail.style.transform = 'translateY(-2px) scale(1.02)';
        }
      });

      thumbnail.addEventListener('mouseleave', () => {
        if (!thumbnail.classList.contains('active')) {
          thumbnail.style.transform = '';
        }
      });
    });

    // Set initial active thumbnail
    updateThumbnailActive(0);

    // Handle window resize to update swipers
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        if (pdpMobileProductSwiper) {
          pdpMobileProductSwiper.update();
        }
        if (pdpThumbnailSwiper) {
          pdpThumbnailSwiper.update();
        }
      }, 250);
    });

    // Keyboard navigation support
    document.addEventListener('keydown', (e) => {
      if (!pdpMobileProductSwiper) return;
      
      switch(e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          pdpMobileProductSwiper.slidePrev();
          break;
        case 'ArrowRight':
          e.preventDefault();
          pdpMobileProductSwiper.slideNext();
          break;
      }
    });

  } catch (error) {
    console.error('Product slider initialization error:', error);
  }
});
</script>